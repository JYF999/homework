# 《实验二：索引操作与文档操作练习》

**学院：省级示范性软件学院**

**题目：《实验二：索引操作与文档操作练习》**

**姓名：焦雨飞**

**学号：2100950007**

**班级：软工2201**

**日期：2024-09-25**

**实验环境：Elasticsearch8.12.2 Kibana8.12.2**

# 一、实验目的



##### 1.掌握Elasticsearch 安装IK分词器安装方法

##### 2.掌握Elasticsearch 索引操作方法

##### 3.掌握Elasticsearch 文档操作训练

##### 4.掌握Elasticsearch 高级查询与DSL训练

# 二、实验内容

## 1. 索引操作练习

### 任务一：

#### 1.创建索引

##### 1.用户信息索引

###### 代码：

![image-20240923175040512](./图片/image-20240923175040512.png)

###### 结果：

![image-20240923180343389](./图片/image-20240923180343389.png)

##### 2.产品目录索引

###### 代码：

###### ![image-20240923175057952](./图片/image-20240923175057952.png)

###### 结果：

![image-20240923180436313](./图片/image-20240923180436313.png)

##### 3.订单记录索引

###### 代码：

![image-20240923180519173](./图片/image-20240923180519173.png)

###### 结果：

![image-20240923180547029](./图片/image-20240923180547029.png)

#### 2.修改索引(自己设计，修改要合理）

##### 1.为用户信息索引添加字段“nickname”

###### 代码：

![image-20240923180730820](./图片/image-20240923180730820.png)

###### 结果：

![image-20240923180343389](./图片/image-20240923180343389-1727274561080-4.png)

##### 2.为产品目录索引添加字段“discount_price”

###### 代码：

![image-20240923181048210](./图片/image-20240923181048210.png)

###### 结果：

![image-20240923181212649](./图片/image-20240923181212649.png)

##### 3.为订单记录索引添加字段“customer_name”

###### 代码：

![image-20240923181513840](./图片/image-20240923181513840.png)

###### 结果：

![image-20240923181626404](./图片/image-20240923181626404.png)

#### 3.删除索引

###### 代码：

![image-20240923181802900](./图片/image-20240923181802900.png)

结果：



#### 4.查看所有索引

###### 代码：

![image-20240923182012276](./图片/image-20240923182012276.png)

###### 结果：

![image-20240923182045451](./图片/image-20240923182045451.png)

## 2. 文档操作练习

### 任务二：

#### 1.创建文档（以第一个用户样例为例）

代码：

![image-20240925171632247](./图片/image-20240925171632247.png)

结果：

![image-20240925171746778](./图片/image-20240925171746778.png)

#### 2.修改文档（假设我们想要更新用户`001`的电子邮件地址）

代码：

![image-20240925171947633](./图片/image-20240925171947633.png)

结果：

![image-20240925172014504](./图片/image-20240925172014504.png)

#### 3.删除文档

代码：

![image-20240925172505205](./图片/image-20240925172505205.png)

结果：

![image-20240925172548604](./图片/image-20240925172548604.png)

#### 4.查看文档（查看001的文档）

代码：

![image-20240925172443069](./图片/image-20240925172443069.png)

结果：

![image-20240925172352645](./图片/image-20240925172352645.png)

#### 5.将Json数据批量导入ES数据库中

##### 1.用户文档

代码：

![image-20240925165744302](./图片/image-20240925165744302.png)

结果：

![image-20240925165814193](./图片/image-20240925165814193.png)

##### 2.产品文档

代码：

![image-20240925170304670](./图片/image-20240925170304670.png)

结果：

![image-20240925170340099](./图片/image-20240925170340099.png)

##### 3.订单文档

代码：

![image-20240925170554356](./图片/image-20240925170554356.png)

结果：

![image-20240925170643101](./图片/image-20240925170643101.png)

## 3. 高级查询&DSL练习

### 3.1. 用户信息数据

##### 1.查询所有女性用户的姓名和电子邮件。

代码：

![image-20240925173123667](./图片/image-20240925173123667.png)

结果：

![image-20240925173149730](./图片/image-20240925173149730.png)

##### 2.查找最后登录日期在2024年9月1日之后的所有活跃用户。

代码：

![image-20240925173638355](./图片/image-20240925173638355.png)

结果：

![image-20240925173758353](./图片/image-20240925173758353.png)

##### 3.查询住在"Anytown"的用户。

代码：

![image-20240925174026438](./图片/image-20240925174026438.png)

结果：

![image-20240925174109717](./图片/image-20240925174109717.png)

##### 4.查找出生日期在1990年之后的所有用户。

代码：

![image-20240925174159309](./图片/image-20240925174159309.png)

结果：

![image-20240925174221497](./图片/image-20240925174221497.png)

##### 5.查询所有状态为"inactive"的用户。

代码：

![image-20240925174731954](./图片/image-20240925174731954.png)

结果;

![image-20240925174817657](./图片/image-20240925174817657.png)

##### 6.查找注册日期在2023年1月1日到2023年12月31日之间的用户。

代码：

![image-20240925175002270](./图片/image-20240925175002270.png)

结果:

![image-20240925175025906](./图片/image-20240925175025906.png)

##### 7.查询名字为"Bob Smith"的用户的详细信息。

代码：

![image-20240925175121059](./图片/image-20240925175121059.png)

结果:

![image-20240925175141495](./图片/image-20240925175141495.png)

##### 8.查找电话号码以"123"开头的用户。

代码：

![image-20240925175205497](./图片/image-20240925175205497.png)

结果:

![image-20240925175220070](./图片/image-20240925175220070.png)

##### 9.查询电子邮件域为"example.com"的所有用户。

代码：

![image-20240925175253938](./图片/image-20240925175253938.png)

结果：

![image-20240925175349818](./图片/image-20240925175349818.png)

##### 10.查找所有名字中包含"Lee"的用户。

代码：

![image-20240925175409552](./图片/image-20240925175409552.png)

结果：

![image-20240925175445766](./图片/image-20240925175445766.png)

### 3.2. 产品目录数据

##### 1.查询所有类别为"Audio"的产品名称和价格。

代码：

![image-20240925181441534](./图片/image-20240925181441534.png)

结果：

![image-20240925181752350](./图片/image-20240925181752350.png)

##### 2.查找价格高于50美元的所有产品。

代码：

![image-20240925181813330](./图片/image-20240925181813330.png)

结果：

![image-20240925181824861](./图片/image-20240925181824861.png)

##### 3.查询库存数量少于100的产品。

代码：

![image-20240925181851893](./图片/image-20240925181851893.png)

结果：

![image-20240925181903066](./图片/image-20240925181903066.png)

##### 4.查找评分高于4.5的所有产品。

代码：

![image-20240925181920351](./图片/image-20240925181920351.png)

结果：

![image-20240925181930998](./图片/image-20240925181930998.png)

##### 5.查询标签中包含"smart"的所有产品。

代码：

![image-20240925181958027](./图片/image-20240925181958027.png)

结果：

![image-20240925182010594](./图片/image-20240925182010594.png)

##### 6.查找供应商为"TechCorp"的产品。

代码：

![image-20240925182027799](./图片/image-20240925182027799.png)

结果：

![image-20240925182044190](./图片/image-20240925182044190.png)

##### 7.查询发布日期在2023年6月1日之后的所有产品。

代码：

![image-20240925182055570](./图片/image-20240925182055570.png)

结果：

![image-20240925182110502](./图片/image-20240925182110502.png)

##### 8.查找描述中包含"wireless"的产品。

代码：

![image-20240925182130795](./图片/image-20240925182130795.png)

结果：

![image-20240925182140751](./图片/image-20240925182140751.png)

##### 9.查询价格在20美元到100美元之间的所有产品。

代码：

![image-20240925182154118](./图片/image-20240925182154118.png)

结果：

![image-20240925182212815](./图片/image-20240925182212815.png)

##### 10.查找产品名称中包含"Light"的所有产品。

代码：

![image-20240925182230238](./图片/image-20240925182230238.png)

结果：

![image-20240925182244408](./图片/image-20240925182244408.png)

### 3.3. 订单记录数据

##### 1.查询所有状态为"completed"的订单的订单ID和总金额。

代码：

![image-20240925182304456](./图片/image-20240925182304456.png)

结果：

![image-20240925182314411](./图片/image-20240925182314411.png)

##### 2.查找总金额大于100美元的所有订单。

代码：

![image-20240925182335726](./图片/image-20240925182335726.png)

结果：

![image-20240925182346657](./图片/image-20240925182346657.png)

##### 3.查询支付方式为"paypal"的订单。

代码：

![image-20240925182402887](./图片/image-20240925182402887.png)

结果：

![image-20240925182412784](./图片/image-20240925182412784.png)

##### 4.查找订单日期在2024年2月之后的所有订单。

代码：

![image-20240925182427984](./图片/image-20240925182427984.png)

结果：

![image-20240925182438018](./图片/image-20240925182438018.png)

##### 5.查询包含产品ID为"P001"的订单。

代码：

![image-20240925182508168](./图片/image-20240925182508168.png)

结果：

![image-20240925182520021](./图片/image-20240925182520021.png)

##### 6.查找所有状态为"cancelled"的订单的客户ID。

代码：

![image-20240925182543273](./图片/image-20240925182543273.png)

结果：

![image-20240925182555273](./图片/image-20240925182555273.png)

##### 7.查询发货日期在2024年1月15日之前的订单。

代码：

![image-20240925182612571](./图片/image-20240925182612571.png)

结果：

![image-20240925182621959](./图片/image-20240925182621959.png)

##### 8.查找使用"credit_card"支付的订单。

代码：

![image-20240925182641918](./图片/image-20240925182641918.png)

结果：

![image-20240925182651680](./图片/image-20240925182651680.png)

##### 9.查询总金额在50美元到200美元之间的所有订单。

代码：

![image-20240925182710272](./图片/image-20240925182710272.png)

结果：

![image-20240925182721306](./图片/image-20240925182721306.png)

##### 10.查找订单ID中包含"OR01"的所有订单。

代码：

![image-20240925182744163](./图片/image-20240925182744163.png)

结果：

![image-20240925182755325](./图片/image-20240925182755325.png)

# 三、问题及解决办法

**问题1：** 修改索引结构失败。

**解决办法：**

1. 确保索引存在且当前用户有修改权限。
2. 检查添加的字段是否符合Elasticsearch的字段命名规则。
3. 使用正确的API命令进行修改。

**问题2：** 批量导入数据时速度慢。

**解决办法：**

1. 优化数据格式，减少不必要的字段。

2. 调整Elasticsearch的批量导入设置，如`bulk_size`。

3. 使用Elasticsearch的Bulk API进行批量操作。

   ![image-20240925165744302](./图片/image-20240925165744302.png)

**问题3：** 查询结果不符合预期。

**解决办法：**

1. 检查查询语句是否正确编写，特别是字段名和查询条件。

2. 确保查询使用的字段已经被正确索引。

   
